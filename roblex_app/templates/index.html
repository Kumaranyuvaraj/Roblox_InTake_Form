{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WCBZJQFX');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roblox Sexual Abuse Lawsuit & Child Exploitation Claims - Know Your Rights</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">
    

    
    <!-- <style>
        #documentStatusBanner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: 'Poppins', sans-serif;
            min-height: 60px;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
            padding: 20px;
            margin: 0;
            border-radius: 0;
            text-align: center;
            border: none;
            width: 100%;
        }
        
        #documentStatusBanner.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        
        #documentStatusBanner.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffeaa7;
            color: #856404;
        }
        
        #documentStatusBanner #statusTitle {
            font-weight: 600;
            margin-bottom: 8px;
            margin-top: 0;
        }
        
        #documentStatusBanner #statusMessage {
            font-weight: 400;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        #documentStatusBanner .container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        #documentStatusBanner .btn-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            font-weight: bold;
            color: inherit;
            opacity: 0.5;
            cursor: pointer;
            padding: 0;
            margin: 0;
            line-height: 1;
        }
        
        #documentStatusBanner .btn-close:hover {
            opacity: 1;
        }
    </style> -->

    <style>
    #spinnerOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    }

    .spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #4a90e2;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    }

    .inline-spinner {
        border: 2px solid transparent;
        border-top: 2px solid #ffffff;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-left: 8px;
    }

    @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
    }


    .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
}

    .btn-blue {
        background-color: #1e3a8a;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-red {
        background-color: #dc2626;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-blue:hover {
        background-color: #3b82f6;
    }

    .btn-red:hover {
        background-color: #ef4444;
    }


    </style>
</head>
   

    <body>
    <!-- Success/Decline Message Banner -->
    <!-- <div id="documentStatusBanner" style="display: none;">
        <div class="container">
            <h4 id="statusTitle"></h4>
            <p id="statusMessage"></p>
            <button type="button" class="btn-close" aria-label="Close">&times;</button>
        </div>
    </div> -->

          <!-- <nav class="navbar">
        <div class="nav-content">
            <a href="#" class="logo px-4">Logo Here</a>
            <div class="nav-links">
                <a href="#about">About</a>
                <a href="#cases">Cases</a>
                <a href="#resources">Resources</a>
                <a href="#contact">Contact</a>
            </div>
        </div>
    </nav> -->

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WCBZJQFX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager¬†(noscript)¬†-->

    <section class="hero">
      
        <a href="" class="logo  d-flex justify-content-left">
            <img src="{% static 'img/theme.svg' %}" alt="Logo">
            <!-- <img src="../static/img/theme.svg" alt="Logo" > -->
        </a>
        <div class="hero-content">
              

            <h1>Roblox Sexual Abuse Lawsuit & Child Exploitation Claims - Know Your Rights</h1>
            <div class="separator"></div>
            <!-- <p>Roblox, the world's largest user-generated gaming platform "designed for children," attracts 78 million daily visitors</p> -->
            <p class="hero-text">If your child was groomed, exploited, or abused through Roblox, you are not alone and you may have legal options. Roblox has become one of the most popular online gaming platforms for children, but its chat features, user-generated games, and open social spaces have also been exploited by online predators.</p>
            <p class="hero-text">Our legal team is actively investigating Roblox sexual abuse lawsuits on behalf of children who have been targeted by predators in the game. If your child has been harmed, you may be entitled to compensation. We‚Äôre here to help-just follow these 3 simple steps.</p>
            
            <!-- <div class="sub-heading">Has your child experienced any of the following while online gaming: sexual assault, grooming, exchange of sexually explicit images, sex trafficking, hacking, or economic loss? If yes, we‚Äôre here to help-just follow these 3 simple steps.</div> -->
           
            <div class="step-wrapper">
                <div class="steps">
                    <div class="step-icon">
                        <img src="{% static 'img/icon-prequalify.svg' %}" alt="Prequalify">
                    </div>
                    <div>
                        <small class="pt-2 pb-1">Step 1</small>
                        <h4>Prequalify</h4>
                        <p>Briefly explain what happened during the troubling Roblox encounter.</p>
                    </div>
                </div>
                <div class="steps">
                    <div class="step-icon">
                        <img src="{% static 'img/icon-retainer.svg' %}" alt="Prequalify">
                    </div>
                    <div>
                        <small class="pt-2 pb-1">Step 2</small>
                        <h4>Retainer</h4>
                        <p>We‚Äôll provide a simple agreement so we can move forward.</p>
                    </div>
                </div>
                <div class="steps">
                    <div class="step-icon">
                        <img src="{% static 'img/icon-intake.svg' %}" alt="Prequalify">
                    </div>
                    <div>
                        <small class="pt-2 pb-1">Step 3</small>
                        <h4>Intake</h4>
                        <p>Complete a quick intake form to understand how we can best help.</p>
                    </div>
                </div>
                
            </div>
            <div class="row mt-4" id="fixBtnRow">
                <div class=" d-flex justify-content-center">
                    <!-- <button class="btn px-5 mx-3" id="openModal" >Yes</button> -->
                    <button class="home-btn" id="openModal" >Check Prequalification</button>
                </div>
            </div>

        </div>
    </section>

    <!-- <main class="main-content">
        <div class="content-grid">
            <div class="content-card">
                <div class="card-icon"><img src="{% static 'img/icon-expertise1.svg' %}" alt="Case Evaluation"></div>
                <div>
                    <h3>Class Action Expertise</h3>
                    <p>Specialized representation for group litigation matters, ensuring collective justice and fair compensation.</p>
                </div>
            </div>
            <div class="content-card">
                <div class="card-icon"><img src="{% static 'img/icon-expertise2.svg' %}" alt="Case Evaluation"></div>
                <div>
                    <h3>Case Evaluation</h3>
                    <p>Thorough analysis of legal claims to determine optimal strategies for successful resolution.</p>
                </div>
            </div>
            <div class="content-card">
                <div class="card-icon"><img src="{% static 'img/icon-expertise3.svg' %}" alt="Case Evaluation"></div>
                <div>
                    <h3>Client Advocacy</h3>
                    <p>Dedicated protection of client interests through aggressive litigation and negotiation tactics.</p>
                </div>
            </div>
        </div>
    </main> -->
    <div class="section-content primary-color">
        <div class="row px-4 py-5">
            <div class="col-12 col-md-4 text-center pb-4 pb-md-0">
                <!-- <img src="{% static 'img/Roblox-sec1.png' %}" alt="Roblox Image"> -->
                <img src="{% static 'img/Roblox-sec1.png' %}" alt="Roblox Image">
            </div>
            <div class="col-12 col-md-8 d-flex flex-column justify-content-center">
                <h4>How Online Predators Exploit Roblox?</h4>
                <p>While Roblox can be a space for creativity and fun, predators have found ways to misuse it to target minors. Common tactics include:</p>
                <ul>
                    <li><strong>In-Game Chats & Direct Messaging</strong><br>Starting casual conversations in public games, then moving to private messages or off-platform apps like Discord or Snapchat.</li>
                    <li><strong>Manipulative Role-Play & Avatars</strong><br>Using avatars that mimic children‚Äôs appearances to gain trust, often in ‚Äúfamily‚Äù or ‚Äúschool‚Äù type roleplay games.</li>
                    <li><strong>Grooming Through Gifts & Trust-Building </strong><br>Offering Robux or other digital rewards, slowly introducing mature content, and pressuring children to keep secrets or share explicit images.</li>
                </ul>
            </div>
</div>
    </div>
    <div class="section-safeguard secondary-color1">
        <div class="row px-4 py-5">
             
        <div class="col-12 col-md-8 bg-light-opacity d-flex flex-column justify-content-center">
            <h4>Warning Signs Your Child May Be a Victim</h4>
            <p>Parents should look out for:</p>
            <ul>
                <li>Secretive online behavior or hiding their screen</li>
                <li>Sudden mood changes or signs of distress after playing Roblox</li>
                <li>Unexplained Robux or virtual gifts</li>
                <li>Requests to talk privately or move to another platform</li>
            </ul>
           
            <p>If you‚Äôve noticed these signs, it‚Äôs possible your child is experiencing <strong>online grooming</strong> and you should take immediate action.</p>


            
                </div>    
                 <div class=" col-12 col-md-4 text-center ">
                    <!-- <img src="{% static 'img/Roblox-md-3.jpeg' %}"> -->
                    <img src="{% static 'img/Roblox-md-3.jpeg' %}" alt="Roblox Safeguards Image">
                 </div>    
</div>
    </div>

    <div class="section-Lawsuit py-5">
        <div class="row px-4">
            <div class="col-12">
                <h4>Legal Help for Roblox Grooming & Abuse Victims</h4>
                <p>If your child was a victim of grooming, sexual exploitation, or abuse involving Roblox:</p>
                <div class="d-block d-md-flex justify-content-between gap-5">
                    <div class=" lawsuit-box">
                        <p><span class="fw-bold">You may be eligible to file a lawsuit</span class="fw-bold"> against Roblox and/or other entities. </p>
                    </div>
                    <div class="lawsuit-box">
                        <p>There are <span class="fw-bold">strict deadlines (statutes of limitation)</span class="fw-bold"> for taking legal action. Do not delay.</p>
                    </div>
                    <div class="lawsuit-box mb-0">
                        <p>Our Roblox abuse attorneys handle these cases <span class="fw-bold">confidentially and with compassion.</span class="fw-bold"></p>

                    </div>
                </div>
            </div>
            <!-- <div class="col-12 col-md-6 text-center"> -->
            <!-- <img src="{% static 'img/Roblox-md-2.jpeg' %}"> -->
            <!-- </div> -->
        </div>

    </div>

    <div class="disclaimer py-4">
        <div class="row">
            <div class="col-12">
        
               <p><strong>DISCLAIMER:</strong> The hiring of a lawyer is an important decision that should not be based solely on advertisements. The material contained on <a href="https://nextkeylitigation.com" target="_blank">nextkeylitigation.com</a> is for general informational purposes only and does not constitute legal advice. Our list of participating law firms is licensed to practice law only in the following states: Ohio, Texas, Georgia, Mississippi, California¬†and¬†Florida.</p>

                     <p class="mb-0"> ¬© 2025 All rights reserved. NextKey Litigation.</p>
            </div>
        </div>
        
        

    </div>
    <footer class="footer text-secondary">
        <div class="d-block d-md-flex justify-content-between align-items-center px-3 py-2">

            <div>
                <a href="{% url 'about_us' %}" class="text-secondary">About Us</a> |
                <a href="{% url 'consent_box' %}" class="text-secondary">Consent Box</a> |
                <a href="{% url 'disclaimer' %}" class="text-secondary">Disclaimer</a> |
                <a href="{% url 'participating_firms' %}" class="text-secondary">Participating Firms</a> |
                <a href="{% url 'privacy_policy' %}" class="text-secondary">Privacy Policy</a> |
                <a href="{% url 'terms_of_service' %}" class="text-secondary">Terms of Service</a> 


                
            </div>
            <div class="d-flex align-items-center gap-2">
                <span>Follow us on:</span>
                <a href="https://facebook.com" target="_blank" class="text-secondary">
                    <img src="{% static 'img/facebook.png' %}" alt="Facebook" width="20" />
                </a>
                <a href="https://instagram.com" target="_blank" class="text-secondary">
                    <img src="{% static 'img/insta.png' %}" alt="Instagram" width="20" />
                </a>
            </div>
        </div>
    </footer>



    <!-- modal popup code -->
     <div class="modal-overlay" id="modal">
        <div class="modal-content scroll" style="width: 90%;">
            <div class="row justify-content-end">
                <button class="col-12 close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="form-screen px-3" id="screen1" style="display: block;">
                <div class="row">
                     <!-- Screen 1 -->
                    <div class="col-12 col-md-6">
                        <h4 class="model-title">Prequalification</h4>
                         <div class="input-group">
                            <!-- <label>Did your child play Roblox?</label>
                           <select id="question_9" class="question-dropdown"
                                data-question-text="Did your child play Roblox?"></select> -->
                            
                            <label>Do you have an attorney for a Roblox Assault claim? *</label>
                           <select id="question_10" class="question-dropdown"
                                data-question-text="Do you have an attorney for a Roblox Assault claim? *"></select>

                        </div>
                         <div class="input-group">
                            <label>Are you currently over the age of 18? *</label>
                            <!-- <input type="text" id="" placeholder=" " data-question-text="When did your child begin playing Roblox?" required> -->
                             <select id="question_11" class="question-dropdown"
                                data-question-text="Are you currently over the age of 18? *"></select>

                        </div>

                        <!-- <div class="input-group">
                            <label>What best describes the troubling actions?</label>
                            <select id="question_3" class="question-dropdown"
                                data-question-text="What best describes the troubling actions?"></select>
                        </div> -->

                        <div class="input-group">
                            <label>	Did you or your child come in contact with an online predator through Roblox? *</label>
                            <select id="question_16" class="question-dropdown"
                                data-question-text="Did you or your child come in contact with an online predator through Roblox? *"></select>
                        </div>
                          
                        <div class="input-group">
                            <label> Were you or your child under the age of 18 at the time the incidents began? *</label>
                            <select id="question_12" class="question-dropdown"
                                data-question-text="Were you or your child under the age of 18 at the time the incidents began? *"></select>

                        </div>

                 

                        <div class="input-group dropdown w-100">
                            <label class="form-label fw-semibold mb-2">
                                After the encounter with the online predator, did you or your child experience any of the following (Please select all that apply):
                            </label>

                            <button class="btn btn-outline-primary dropdown-toggle dd-btn d-flex justify-content-between align-items-center w-100"
                                    type="button"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                <span class="dropdown-label text-truncate">--Select--</span>
                                <img src="../static/img/down_arrow.jpg" alt="" class="custom-arrow ms-2">
                            </button>

                            <ul id="question_13" class="dropdown-menu p-2 w-100"
                                style="max-height: 250px; overflow-y: auto;">
                                <li>
                                <label class="dropdown-item">
                                    <input id="sexual_contact" name="question_13" type="checkbox"
                                        value="Sexual contact (rape or attempted rape)"
                                        class="form-check-input me-2"/>
                                    Sexual contact (rape or attempted rape)
                                </label>
                                </li>
                                <li>
                                <label class="dropdown-item">
                                    <input id="touching" name="question_13" type="checkbox"
                                        value="Sexual touching or inappropriate physical contact"
                                        class="form-check-input me-2"/>
                                    Sexual touching or inappropriate physical contact
                                </label>
                                </li>
                                <li>
                                <label class="dropdown-item">
                                    <input id="photos_videos" name="question_13" type="checkbox"
                                        value="Request for sexual photos/videos"
                                        class="form-check-input me-2"/>
                                    Request for sexual photos/videos
                                </label>
                                </li>
                                <li>
                                <label class="dropdown-item">
                                    <input id="manipulated" name="question_13" type="checkbox"
                                        value="Manipulated/pressured into a sexual relationship"
                                        class="form-check-input me-2"/>
                                    Manipulated/pressured into a sexual relationship
                                </label>
                                </li>
                                <li>
                                <label class="dropdown-item">
                                    <input id="travel" name="question_13" type="checkbox"
                                        value="Travel to performing sexual acts"
                                        class="form-check-input me-2"/>
                                    Travel to performing sexual acts
                                </label>
                                </li>
                                <li>
                                <label class="dropdown-item">
                                    <input id="grooming" name="question_13" type="checkbox"
                                        value="Grooming or messaging child multiple times in a sexual/inappropriate way"
                                        class="form-check-input me-2"/>
                                    Grooming or messaging child multiple times in a sexual/inappropriate way
                                </label>
                                </li>
                            </ul>
                            </div>



                        <div class="input-group">
                            <label>After the incident(s), was the abuse or injury reported to any of the following: *</label>
                            <select id="question_14" class="question-dropdown"
                                data-question-text="After the incident(s), was the abuse or injury reported  to any of the following: *"></select>

                        </div>


                        <div class="input-group">
                            <label>To the best of your knowledge, was the perpetrator an adult? *</label>
                            <select id="question_15" class="question-dropdown"
                                data-question-text="To the best of your knowledge, was the perpetrator an adult? *"></select>

                        </div>
                        <!-- <div class="input-group">
                            <label>Within the last 5 weeks, how many hours per day is spent playing Minecraft, Call Of Duty,
                                Fortnite, Roblox or Grand Theft Auto? *</label>
                            <select id="question_5" class="question-dropdown"
                                data-question-text="Within the last 5 weeks, how many hours per day is spent playing Minecraft, Call Of Duty, Fortnite, Roblox or Grand Theft Auto? *"></select>

                        </div> -->
                        <!-- <div class="input-group">
                            <label> What harm has the gamer suffered from? *</label>
                            <select id="question_6" class="question-dropdown"
                                data-question-text="What harm has the gamer suffered from? *"></select>
                        </div>
                        <div class="input-group">
                            <label>What treatment was received as a result of playing video games? *</label>
                            <select id="question_7" class="question-dropdown"
                                data-question-text="What treatment was received as a result of playing video games? *"></select>

                        </div> -->
                        <!-- <div class="mt-3">
                            <label>Child‚Äôs¬†Date¬†of¬†Birth *</label>
                            <input type="text" id="gamer_dob" class="form-control" placeholder="MM-DD-YYYY">
                        </div> -->

                        <div class="form-footer">
                            <!-- <button type="button" class="btn-blue" onclick="showScreen(2)">Next</button> -->
                            <!-- <button type="button" class="btn-blue" onclick="validateScreen1()">Next</button> -->
                        </div>
                    </div>
                     <!-- Screen 2 -->
                    <div class="col-12 col-md-6">
                        <h4 class="model-title mx-0 mx-md-3 ">User information</h4>
                       
                        <div class="form-screen px-0 px-md-3" id="screen2" style="display: block;">
                            
                            <div class="input-group">
                                <label>First Name *</label>
                                <input type="text" id="first_name" placeholder="John" required>
                            </div>
                            <div class="input-group">
                                <label>Last Name *</label>
                                <input type="text" id="last_name" placeholder="Smith" required>
                            </div>
                            <div class="input-group">
                                <label>Cell Phone *</label>
                                <input type="tel" id="cell_phone" placeholder="123-456-7890" required>
                            </div>
                            <div class="input-group">
                                <label>Email *</label>
                                <input type="email" id="email" placeholder="example@domain.com" required>
                            </div>
                            <div class="input-group">
                                <label>Zip Code *</label>
                                <input type="text" id="zipcode" placeholder="12345" maxlength="5" required>
                            </div>
                            <!-- <div class="input-group">
                                <label for="working_with_attorney">Are you currently working with an attorney for gaming
                                    sex¬†abuse¬†claim?¬†*</label>
                                <select id="working_with_attorney" required>
                                    <option value="">Select</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div> -->
                            <div class="input-group">
                                <label>Additional Notes (optional)</label>
                                <input type="text" id="additional_notes" placeholder="Any additional details">
                            </div>
                            <!-- <small id="consent-hint" style="color:gray;">
                                    Please read the <a href="#" id="openConsentBox">Consent Box</a> before making a choice.
                                </small> -->
                                <!-- <p>
                                    Please read the <button class="consentBtn" onclick="showConsentModal()">Consent Box</button> before making a choice.
                                </p> -->

                        </div>
                    </div>

                    <div class="col-12 pe-4">
                        <!-- <small id="consent-hint" style="color:gray;">
                                    Please read the <a href="#" id="openConsentBox">Consent Box</a> before making a choice.
                                </small> -->
                                
                            
                        <!-- Checkboxes -->
                        <div class="input-group d-flex align-items-center gap-3 py-3 shadow-lg consent-cbs">
                            <p class="mb-0">
                                Please read the <button class="consentBtn" onclick="showConsentModal()">Consent Box</button> before making a choice.
                            </p>
                            
                            <label class="cb-label me-4">
                                <input type="checkbox" id="agreecheck" name="agreement_status" value="agree" disabled> Yes, I Agree and Consent
                            </label>
                            <label class="cb-label">
                                <input type="checkbox" id="notAgreecheck" name="agreement_status" value="not_agree" disabled> I
                                Do Not Agree
                            </label>

                            

                            <!-- <a id="openConsentModalBtn" class="btn btn-primary" onclick="showConsentModal()">
                                Open Modal
                            </a> -->
                            <!-- <form class="d-flex gap-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="agreement_status" id="agreecheck"
                                        value="yes">
                                    <label class="form-check-label" for="agreecheck">
                                        Yes, I Agree and Consent
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="agreement_status" id="notAgreecheck"
                                        value="no">
                                    <label class="form-check-label" for="notAgreecheck">
                                        No, I do NOT Agree
                                    </label>
                                </div>
                            </form> -->
                        </div>



                            <div class="form-footer ">
                                <!-- <button type="button" class="btn-blue-outline" onclick="showScreen(1)">Back</button> -->
                                <button type="button" id="submitBtn" class="btn-blue" onclick="submitForm()">
                                    <span id="submitBtnText">Submit</span>
                                    <span id="submitBtnLoader" class="inline-spinner" style="display: none;"></span>
                                </button>
                                <!-- <button class="btn-blue" onclick="showCongrats()">Submit</button> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>


                
            

        </div>
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

        <!-- <form style="display: none;">
            {% csrf_token %}
        </form> -->
    </div>

    <!-- Spinner Overlay -->
    <div id="spinnerOverlay" style="display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.8); z-index: 9999;">
        <div class="spinner"></div>
        <div id="spinnerMessage" style="margin-top: 20px; font-size: 18px; color: #333; text-align: center;">
        Your document is being prepared. Just 2 steps to finish your¬†Roblox¬†claim.
    </div>
</div>





    
<div id="customModal" class="modal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <img id="modalIcon" class="icon" src="" alt="icon" />
            <p id="modalMessage"></p>
            <div class="modal-buttons">
            <button class="btn-blue" onclick="closeCustomModal()">OK</button>
            </div>
        </div>
    </div>
</div>



<!-- Consent Modal -->
<div class="modal fade" id="consentModal" tabindex="-1" aria-labelledby="consentModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="consentModalLabel">NEXTKEY LITIGATION CONSENT BOX</h5>
                <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
            </div>

            <div class="modal-body">
                By checking the box below that says <strong>"Yes, I Agree and Consent"</strong> and clicking the <strong>"Submit"</strong> button, I represent that I am 18+ years of age and have read and agreed to the NextKey Litigation‚Äôs <a href="{% url 'terms_of_service' %}" target="_blank">Terms of Service</a> and <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>. I consent to the transfer of information that I provide on this site to third-party legal service providers and non-legal service providers, third party partners and their affiliates and service providers; I agree to be contacted with marketing by email & telephone, which may include artificial or pre-recorded calls and/or SMS text messages, delivered via automated technology, to the email and phone number that I have provided. I understand that my consent is not a condition of receipt of services.
            </div>

            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-blue" data-bs-dismiss="modal">Close</button> -->
                <button type="button" class="btn btn-blue" data-bs-dismiss="modal" onclick="hideConsentModal" >Close</button>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<script>
    // Read CSRF token from the meta tag and add it to every AJAX request
    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

    
    const csrftoken = getCookie('csrftoken');

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });


    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

   function showConsentModal() {
    var modal = new bootstrap.Modal(document.getElementById('consentModal'));
    modal.show();
}

    // When consent modal is closed ‚Üí enable the checkboxes
    document.getElementById('consentModal').addEventListener('hidden.bs.modal', function () {
        const agreeCheck = document.getElementById("agreecheck");
        const notAgreeCheck = document.getElementById("notAgreecheck");

        // Enable both checkboxes
        agreeCheck.disabled = false;
        notAgreeCheck.disabled = false;

        // Make them mutually exclusive
        agreeCheck.addEventListener("change", function () {
            if (this.checked) {
                notAgreeCheck.checked = false;
            }
        });
        notAgreeCheck.addEventListener("change", function () {
            if (this.checked) {
                agreeCheck.checked = false;
            }
        });
    });


    function hideConsentModal() {
        var modal = bootstrap.Modal.getInstance(document.getElementById('consentModal'));
        if (modal) {
            modal.hide();
        }
    }

    document.getElementById('openModal').addEventListener('click', () => {
        document.getElementById('modal').style.display = 'flex';
    });

    function validatePhone(number, region) {
    try {
        const phone = libphonenumber.parsePhoneNumber(number, region);
        return phone.isValid();
    } catch (e) {
        return false;
    }
}



    // Modal Control
    // document.getElementById('openModal2').addEventListener('click', () => {
    //     document.getElementById('modal').style.display = 'block';
    // });

    const modalBtn2 = document.getElementById('openModal2');
    if (modalBtn2) {
        modalBtn2.addEventListener('click', () => {
            document.getElementById('modal').style.display = 'block';
        });
    }
    // function showScreen(screenNumber) {
    //     document.querySelectorAll('.form-screen').forEach(screen => {
    //         screen.classList.remove('active');
    //     });
    //     document.getElementById(`screen${screenNumber}`).classList.add('active');
    // }

    // ------------------------------
    // Show m-d-Y to the user, submit/store as Y-m-d.
    // maxDate prevents future dates.
    flatpickr("#gamer_dob", {
        altInput: true,
        altFormat: "m-d-Y",   // what the user sees
        dateFormat: "Y-m-d",  // what .val() returns
        maxDate: "today",
        allowInput: true,
        onChange: function(selectedDates, dateStr, instance) {
            // Remove error border when a valid date is selected
            const altInput = instance.altInput;
            if (dateStr) {
            altInput.classList.remove("error-border");
            }
        }
    });

    // const dobInput = document.getElementById('gamer_dob');

    // dobInput.addEventListener('input', function (e) {
    //     const raw = this.value.replace(/\D/g, ''); // remove non-digits
    //     if (raw.length === 8) {
    //         const mm = raw.slice(0, 2);
    //         const dd = raw.slice(2, 4);
    //         const yyyy = raw.slice(4);
    //         const formatted = `${mm}-${dd}-${yyyy}`;

    //         // Set formatted value for user to see
    //         this._flatpickr.setDate(`${yyyy}-${mm}-${dd}`, true); // true = trigger change event
    //     }
    // });


    function parseDobString(d) {
        if (!d) return null;

        // ISO: 1998-07-30
        if (/^\d{4}-\d{2}-\d{2}$/.test(d)) {
            return new Date(d + "T00:00:00");
        }

        // US: 07-30-1998
        if (/^\d{2}-\d{2}-\d{4}$/.test(d)) {
            const [mm, dd, yyyy] = d.split("-");
            return new Date(`${yyyy}-${mm}-${dd}T00:00:00`);
        }

        return null;
    }

    // function calcAge(dob) {
    //     const today = new Date();
    //     let age = today.getFullYear() - dob.getFullYear();
    //     const m = today.getMonth() - dob.getMonth();
    //     if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
    //     return age;
    // }
    // ------------------------------

    // function isValidEmail(email) {
    //     // basic RFC-ish check
    //     return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    // }

    // // Open consent box popup
    // document.getElementById("showConsentModal").addEventListener("click", function (e) {
    //     e.preventDefault();
    //     window.consentWindow = window.open(
    //         "/consent-box",
    //         "ConsentWindow",
    //         "width=800,height=600"
    //     );
    // });

    // Listen for message from consent box window
    window.addEventListener("message", function (event) {
        if (event.data && event.data.allowAgreement) {
            const agreeCheck = document.getElementById("agreecheck");
            const notAgreeCheck = document.getElementById("notAgreecheck");

            // Enable both checkboxes
            agreeCheck.disabled = false;
            notAgreeCheck.disabled = false;

            // Make them mutually exclusive
            agreeCheck.addEventListener("change", function () {
                if (this.checked) {
                    notAgreeCheck.checked = false;
                }
            });

            notAgreeCheck.addEventListener("change", function () {
                if (this.checked) {
                    agreeCheck.checked = false;
                }
            });
        }
    });


    function submitForm() {
        // Clear any existing redirect timeout from previous submissions
        if (window.redirectTimeout) {
            clearTimeout(window.redirectTimeout);
            window.redirectTimeout = null;
        }
        
        // Show loading state on submit button
        showSubmitLoader();

        let isValid = true;

        // Screen 1 Validate required select fields marked with asterisk in data-question-text
            const selects = document.querySelectorAll("#screen1 .question-dropdown");
            selects.forEach(select => {
                const isRequired = select.dataset.questionText?.includes("*");
                if (isRequired && !select.value) {
                    select.classList.add("error-border");
                    isValid = false;
                } else {
                    select.classList.remove("error-border");
                }
            });

            // Validate Date of Birth
            // const dobHiddenInput = document.getElementById("gamer_dob");
            // const dobVisibleInput = dobHiddenInput.nextElementSibling; // flatpickr's altInput

            // if (!dobHiddenInput.value.trim()) {
            //     dobVisibleInput.classList.add("error-border");
            //     isValid = false;
            // } else {
            //     dobVisibleInput.classList.remove("error-border");
            // }
           
        
        // Reset error borders
        $('#screen2 input, #screen2 select').removeClass('error-border');

        // collecting user data

        const first_name = $("#first_name").val().trim();
        const last_name = $("#last_name").val().trim();
        const cell_phone = $("#cell_phone").val().trim();
        const email = $("#email").val().trim();
        const zipcode = $("#zipcode").val().trim();
        const additional_notes = $("#additional_notes").val().trim();

        // collecting the question data:



        // const working_with_attorney = $("#working_with_attorney").val();
        const question_10 = $("#question_10 option:selected").text();
        const question_13 = $("#question_13 option:selected").text();

        const gamer_dob = $("#gamer_dob").val();
        // const consent = $("#consent_checkbox").is(":checked");

        // Get all checked agreement checkboxes
        const checkedAgreements = $("input[name='agreement_status']:checked");
        if (checkedAgreements.length !== 1) {
            $("input[name='agreement_status']").addClass("error-border");
            isValid = false;
        } else {
            agreement_status = checkedAgreements.val(); // will be "agree" or "not_agree"
        }

        

          // Required field check
        if (!first_name) {
            $("#first_name").addClass("error-border");
            isValid = false;
        }
        if (!last_name) {
            $("#last_name").addClass("error-border");
            isValid = false;
        }

        // ‚úÖ Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            $("#email").addClass("error-border");
            isValid = false;
        }

        // ‚úÖ US Cell Phone validation (e.g., (123) 456-7890 or 123-456-7890)
        const phoneRegex = /^(\(\d{3}\)\s*|\d{3}[-.\s]?)\d{3}[-.\s]?\d{4}$/;
        if (!cell_phone || !phoneRegex.test(cell_phone)) {
            $("#cell_phone").addClass("error-border");
            isValid = false;
        }

        // ‚úÖ US Zip Code validation (5-digit or ZIP+4)
        const zipRegex = /^\d{5}(-\d{4})?$/;
        if (!zipcode || !zipRegex.test(zipcode)) {
            $("#zipcode").addClass("error-border");
            isValid = false;
        }

        // if (!working_with_attorney) {
        //     $("#working_with_attorney").addClass("error-border");
        //     isValid = false;
        // }

   
        // if (!consent) {
        //     $("#agreement_status").addClass("error-border");
        //     isValid = false;
        // }

        
        // Block submission if any errors
        if (!isValid) {
            hideSubmitLoader();
            return;
        }

        // const age = calcAge(dob);
        // if (age > 20) {
        //     showModal("Age of gamer is more than 20, so you're not eligible.");
        //     return;
        // }

    //     if (working_with_attorney === "yes") {
    //     showModal("You are currently working with an attorney for a gaming sex abuse claim, so you're not eligible.","error");
    //     return;
    // }



        // ‚úÖ Step 1: Submit user details
        $.ajax({
            url: "/api/user-details/",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                first_name,
                last_name,
                cell_phone,
                email,
                zipcode,
                additional_notes,
                agreement_status
            }),
            success: function (response) {
                const userId = response.id;
                
                // Store userId globally for document creation during this session
                window.currentUserId = userId;
                
                // Build redirect URL now that we have userId
                const redirectUrl = `/intake-form/${userId}/?prequalified=true`;

                //  submitAnswers(userId, function () {
                //     showModal("All submitted!", "success");
                //     window.location.href = redirectUrl;  // üîÅ Redirect here
                // });

                // ‚úÖ Step 2: Store guardian names for form prefilling (still needed for forms.html)
                sessionStorage.setItem("guardian_first_name", first_name);
                sessionStorage.setItem("guardian_last_name", last_name);

                // ‚úÖ Step 3: Determine eligibility from DOB
                const dobValue = $("#gamer_dob").val()?.trim();
                // if (!dobValue) {
                //     alert("Please enter the gamer's Date of Birth.");
                //     return;
                // }

                // Parse DOB and calculate age using helper functions
                const dob = parseDobString(dobValue);
                // if (!dob || isNaN(dob.getTime())) {
                //     alert("Please enter DOB in MM-DD-YYYY format.");
                //     return;
                // }
                // const age = calcAge(dob);

                // Find "Age of gamer" question and matching option
                const ageQuestion = questionsData.find(q =>
                    q.text.toLowerCase().includes("age of gamer")
                );

               // ‚úÖ Check both conditions first
                // if (age > 20 && working_with_attorney === "yes") {
                //     showModal(
                //         "Age of gamer is more than 20 and you are currently working with an attorney for a gaming sex abuse claim, so you're not eligible.",
                //         "error"
                //     );
                //     setTimeout(() => {
                //         window.location.href = "/";
                //     }, 15000);
                //     return; // Stop further processing
                // }

      

                // let matchedOption = null;
                // if (ageQuestion) {
                //     debugger;
                //     ageQuestion.options.forEach(opt => {
                //         const text = opt.text.trim();
                //         if (text.includes("+")) {
                //             const min = parseInt(text);
                //             if (age >= min) matchedOption = opt;
                //         } else if (text.includes("-")) {
                //             const [min, max] = text.split("-").map(Number);
                //             if (age >= min && age <= max) matchedOption = opt;
                //         }
                //     });
                // }

                // if (!matchedOption) return;

                // if (!matchedOption) {
                //     showModal("No matching age group found for the entered DOB.", "error");
                //     return;
                // }

                // ‚úÖ Step 4: Get the 4 decision-making questions and apply logic
                const question_10 = $("#question_10 option:selected").text(); // Attorney
                const question_11 = $("#question_11 option:selected").text(); // Over 18
                const question_16 = $("#question_16 option:selected").text(); // Predator contact
                const question_12 = $("#question_12 option:selected").text(); // Under 18 when incidents began

                console.log("Decision Making Answers:");
                console.log("1. Attorney:", question_10);
                console.log("2. Over 18:", question_11);
                console.log("3. Predator contact:", question_16);
                console.log("4. Under 18 when incidents began:", question_12);

                // Apply decision logic based on the 4 questions
                const hasAttorney = question_10 === "Yes";
                const isOver18 = question_11 === "Yes";
                const hasPredatorContact = question_16 === "Yes";
                const wasUnder18WhenIncidentsBegan = question_12 === "Yes";

                // Determine disqualification reasons
                let disqualified = false;
                let disqualificationMessage = "";

                // Check all combinations and set appropriate message
                if (hasAttorney && !hasPredatorContact && !wasUnder18WhenIncidentsBegan) {
                    disqualified = true;
                    disqualificationMessage = "You are already represented by an attorney, no predator contact was indicated, and incidents began at 18 or older. We cannot proceed. Reapply only if your situation changes.";
                } else if (hasAttorney && !hasPredatorContact) {
                    disqualified = true;
                    disqualificationMessage = "You are already represented by an attorney, and no contact with a Roblox predator was indicated. We cannot proceed. Reapply only if your representation changes.";
                } else if (hasAttorney && !wasUnder18WhenIncidentsBegan) {
                    disqualified = true;
                    disqualificationMessage = "You are already represented by an attorney, and the incidents began at 18 or older. We cannot proceed. Reapply only if your situation changes.";
                } else if (!hasPredatorContact && !wasUnder18WhenIncidentsBegan) {
                    disqualified = true;
                    disqualificationMessage = "No contact with a Roblox predator was indicated, and incidents began at 18 or older. This case is not eligible. Update your answers if this was selected in error.";
                } else if (hasAttorney) {
                    disqualified = true;
                    disqualificationMessage = "You are already represented by an attorney for this matter, so we cannot proceed with a new case. If your representation changes, you may reapply.";
                } else if (!hasPredatorContact) {
                    disqualified = true;
                    disqualificationMessage = "No contact with a Roblox predator was indicated. This case does not meet eligibility. Update your answers if this was selected in error.";
                } else if (!wasUnder18WhenIncidentsBegan) {
                    disqualified = true;
                    disqualificationMessage = "Incidents began when you/your child were 18 or older, which falls outside eligibility. Update your answers if this was selected in error.";
                }

                if (disqualified) {
                    // Send rejection email and show disqualification message
                    $.ajax({
                        url: `/api/email-template/rejected/`,
                        type: "GET",
                        success: function (template) {
                            // Replace placeholder with user name
                            const subject = template.subject;
                            const body = template.body.replace("[User First Name]", first_name);

                            // Send rejection email
                            const emailFormData = new FormData();
                            emailFormData.append("from_email", "kumaranyuvaraj007@gmail.com");
                            emailFormData.append("to_email", email);
                            emailFormData.append("subject", subject);
                            emailFormData.append("body", body);

                            $.ajax({
                                url: "/send-email/",
                                type: "POST",
                                data: emailFormData,
                                processData: false,
                                contentType: false,
                                success: function () {
                                    hideSubmitLoader();
                                    showModal(disqualificationMessage, "error");
                                },
                                error: function (xhr) {
                                    hideSubmitLoader();
                                    const err = xhr.responseJSON?.error || "Error sending email.";
                                    showModal("Error: " + err, "error");
                                }
                            });
                        },
                        error: function () {
                            hideSubmitLoader();
                            showModal("Could not process request. Please try again.", "error");
                        }
                    });
                } else {
                    // User is eligible - proceed with document workflow
                    submitAnswers(userId);
                }
            },
            error: function (xhr) {
                hideSubmitLoader();
                console.error(xhr.responseJSON);
                alert("Error submitting the form.");
            }
        });
    }

    function showModal(message, type = "info") {
    const iconSources = {
            // success: "{% static 'img/tick.jpg' %}",
            success:"../static/img/tick.jpg",
            error: "{% static 'img/error.jpg' %}",
            info: "{% static 'img/info.jpg' %}"
        };

        $("#modalMessage").text(message);
        $("#modalIcon").attr("src", iconSources[type] || iconSources.info);

        $("#customModal").fadeIn();
        $("#customModal").css("display", "flex");  
    }



    function closeCustomModal() {
        $("#customModal").fadeOut();
        
        // Clear any pending redirect timeout when modal is closed
        if (window.redirectTimeout) {
            clearTimeout(window.redirectTimeout);
            window.redirectTimeout = null;
        }
    }

    function redirectToGratitude() {
        window.location.href = "/gratitude/";
    }

    function redirectToHomepage() {
        window.location.href = "/";
    }

    function showSubmitLoader() {
        const submitBtn = document.getElementById('submitBtn');
        const submitBtnText = document.getElementById('submitBtnText');
        const submitBtnLoader = document.getElementById('submitBtnLoader');
        
        if (submitBtn && submitBtnText && submitBtnLoader) {
            submitBtn.disabled = true;
            submitBtnText.textContent = 'Processing...';
            submitBtnLoader.style.display = 'inline-block';
        }
    }

    function hideSubmitLoader() {
        const submitBtn = document.getElementById('submitBtn');
        const submitBtnText = document.getElementById('submitBtnText');
        const submitBtnLoader = document.getElementById('submitBtnLoader');
        
        if (submitBtn && submitBtnText && submitBtnLoader) {
            submitBtn.disabled = false;
            submitBtnText.textContent = 'Submit';
            submitBtnLoader.style.display = 'none';
        }
    }


    // $("#userForm")[0].reset();
    let questionsData = [];

    /**
     * Check URL parameters for document signing status and show appropriate message
     */
    /**
     * Show document status message banner
     */
    function showDocumentStatusMessage(type, title, message) {        
        const banner = document.getElementById('documentStatusBanner');
        const titleElement = document.getElementById('statusTitle');
        const messageElement = document.getElementById('statusMessage');
        if (!banner || !titleElement || !messageElement) {
            console.error('Required elements not found');
            return;
        }
        
        // Set content
        titleElement.textContent = title;
        messageElement.textContent = message;
        
        // Remove existing type classes and add new one
        banner.className = '';
        banner.classList.add(type);
        
        // Show the banner with animation
        banner.style.display = 'block';
        
        // Use setTimeout to trigger opacity transition after element is shown
        setTimeout(() => {
            banner.style.opacity = '1';
        }, 50);

        // Auto-hide after 15 seconds
        setTimeout(() => {
            banner.style.opacity = '0';
            setTimeout(() => {
                banner.style.display = 'none';
            }, 500);
        }, 15000);
        
        // Smooth scroll to top to ensure user sees the message
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Handle manual close button
        const closeBtn = banner.querySelector('.btn-close');
        if (closeBtn) {
            closeBtn.onclick = function() {
                banner.style.opacity = '0';
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 500);
            };
        }
    }

    $(document).ready(function () {
        // Backend now handles document signing redirects directly

        $.ajax({
            url: "/api/questions/",
            type: "GET",
            success: function (response) {
                questionsData = response;

                $(".question-dropdown").each(function () {
                    const $select = $(this);
                    const questionText = $select.data("question-text").trim();

                    const matchingQuestion = response.find(q => q.text.trim() === questionText);

                    if (matchingQuestion) {
                        $select.attr("data-question-id", matchingQuestion.id);
                        $select.append(`<option value="">-- Select --</option>`);
                        console.log("matchingQuestion", matchingQuestion);
                        matchingQuestion.options.forEach(opt => {
                            $select.append(`<option value="${opt.id}">${opt.text}</option>`);
                        });
                    } else {
                        console.warn(`No matching question found for: ${questionText}`);
                    }
                });
            },
            error: function () {
                alert("Failed to load questions.");
            }
        });

        // Remove error-border on input/select change
        $('#screen2 input, #screen2 select').on('input change', function () {
            if ($(this).val().trim()) {
                $(this).removeClass('error-border');
            }
        });

        // $('#consent_checkbox').on('change', function () {
        //     if (this.checked) {
        //         $(this).removeClass('error-border');
        //     }
        // });

        // Auto-format US phone number: 123-456-7890
        $('#cell_phone').on('input', function () {
            let cleaned = $(this).val().replace(/\D/g, ''); // Remove non-digits
            if (cleaned.length > 10) cleaned = cleaned.slice(0, 10); // Limit to 10 digits

            let formatted = cleaned;
            if (cleaned.length > 6) {
                formatted = cleaned.replace(/(\d{3})(\d{3})(\d{1,4})/, '$1-$2-$3');
            } else if (cleaned.length > 3) {
                formatted = cleaned.replace(/(\d{3})(\d{1,3})/, '$1-$2');
            }

            $(this).val(formatted);
        });
        // Auto-format US Zip Code: 12345
        $('#zipcode').on('input', function () {
            let value = $(this).val().replace(/\D/g, ''); // Remove non-digits
            if (value.length > 5) value = value.slice(0, 5); // Limit to 5 digits
            $(this).val(value);
        });
    });







    function submitAnswers(userId) {
        const promises = [];
        const csrf = (typeof getCookie === "function") ? getCookie("csrftoken") : null;

        // Save all dropdown answers to database
        $(".question-dropdown").each(function () {
            const $select = $(this);
            const questionId = Number($select.data("question-id"));
            const selectedOptionId = $select.val();

            if (!questionId || !selectedOptionId) return;

            const p = $.ajax({
                url: "/api/answers/submit/",
                type: "POST",
                contentType: "application/json",
                headers: csrf ? { "X-CSRFToken": csrf } : {},
                data: JSON.stringify({
                    user: userId,
                    question: questionId,
                    selected_option: selectedOptionId
                })
            }).fail(xhr => {
                console.error(`Failed to submit answer for Question ID ${questionId}:`, xhr.responseJSON || xhr.responseText);
            });
            promises.push(p);
        });

        // After ALL answers saved, show success modal with continue button
        $.when.apply($, promises).done(function () {
            console.log("All answers submitted successfully");
            
            // Get age determination from the 4-question logic in submitForm
            const question_11 = $("#question_11 option:selected").text(); // Over 18
            const isOver18 = question_11 === "Yes";
            
            // Determine template type based on age
            let templateType = isOver18 ? 'retainer_adult' : 'retainer_minor';
            let emailTemplateType = isOver18 ? 'eligible_no_parent' : 'eligible_with_parent';
            
            // Show Modal function with Continue button
            function showSuccessModal(message, withContinueBtn = true) {
                const modal = document.getElementById('customModal');
                
                // Dynamically update modal content with message and button
                const footer = modal.querySelector('.modal-content');
                footer.innerHTML = `
                    <img id="modalIcon" class="icon" src="../static/img/tick.jpg" alt="success" />
                    <p id="modalMessage">${message}</p>
                    ${withContinueBtn
                        ? `<div class="modal-buttons"><button id="modal-continue-btn" class="btn-blue">Continue</button></div>` 
                        : `<div class="modal-buttons"><button class="btn-blue" onclick="closeCustomModal()">OK</button></div>`}
                `;
                
                $("#customModal").fadeIn();
                $("#customModal").css("display", "flex");
            }
            
            // Hide submit loader and show modal with Continue button
            hideSubmitLoader();
            showSuccessModal("Congrats! Your case is potentially eligible for Video Game Sex abuse claim. Please click Continue to next step", true);
            
            // Attach event AFTER modal is rendered
            setTimeout(() => {
                const continueBtn = document.getElementById("modal-continue-btn");
                
                if (continueBtn) {
                    continueBtn.addEventListener("click", () => {
                        // Show loading spinner
                        const spinnerOverlay = document.getElementById("spinnerOverlay");
                        if (spinnerOverlay) {
                            spinnerOverlay.style.display = "flex";
                        }
                        
                        // Close the modal
                        closeCustomModal();
                        
                        // Create document submission for signing
                        createDocumentSubmission(templateType, emailTemplateType);
                    });
                } else {
                    console.error("Continue button not found!");
                }
            }, 200);
            
        }).fail(function () {
            hideSubmitLoader();
            console.error("Failed to submit some answers");
            alert("There was an error submitting your answers. Please try again.");
        });
    }

window.addEventListener("scroll", function () {
        const button = document.getElementById("fixBtnRow");
        const heroSection = document.querySelector(".hero");

        if (window.scrollY > heroSection.offsetHeight) {
            button.classList.add("fixed-btn");
        } else {
            button.classList.remove("fixed-btn");
        }
    });



    // Validate Screen1
    function validateScreen1() {
        let isValid = true;

        // Validate required select fields marked with asterisk in data-question-text
        const selects = document.querySelectorAll("#screen1 .question-dropdown");
        selects.forEach(select => {
        const isRequired = select.dataset.questionText?.includes("*");
        if (isRequired && !select.value) {
            select.classList.add("error-border");
            isValid = false;
        } else {
            select.classList.remove("error-border");
        }
        });

        // Validate Date of Birth
        const dobHiddenInput = document.getElementById("gamer_dob");
        const dobVisibleInput = dobHiddenInput.nextElementSibling; // flatpickr's altInput

        if (!dobHiddenInput.value.trim()) {
        dobVisibleInput.classList.add("error-border");
        isValid = false;
        } else {
        dobVisibleInput.classList.remove("error-border");
        }

        if (isValid) {
        showScreen(2);
        }
    }

    // Remove red border on change or input
    document.addEventListener("DOMContentLoaded", () => {
    const dobHiddenInput = document.getElementById("gamer_dob");
    const dobVisibleInput = dobHiddenInput?.nextElementSibling; // null-safe access

    document.querySelectorAll("#screen1 select, #screen1 input").forEach(el => {
        el.addEventListener("input", () => el.classList.remove("error-border"));
        el.addEventListener("change", () => el.classList.remove("error-border"));
    });

    if (dobHiddenInput) {
        dobHiddenInput.addEventListener("change", () => {
            if (dobHiddenInput.value.trim()) {
                dobVisibleInput?.classList.remove("error-border");
            }
        });
    }
});


    // ====================
    // NextKeySign Integration Functions
    // ====================
    
    /**
     * Create a document submission and redirect to signing URL
     * @param {string} templateType - Type of document template ('retainer_agreement', etc.)
     * @param {string} emailTemplateType - Type of email template to use for custom message ('eligible_no_parent', 'eligible_with_parent')
     */
    function createDocumentSubmission(templateType = 'retainer_agreement', emailTemplateType = null) {
        // Show loading state
        // showModal("Preparing your document for signing...", "info");
        // Get user detail ID from form (you may need to store this differently)
        const userDetailId = getCurrentUserDetailId();
        
        if (!userDetailId) {
            // showModal("Error: User information not found. Please complete the contact details first.", "error");
            return;
        }
        
        // Map template types to DocumentTemplate names in database
        let dbTemplateName = '';
        let finalEmailTemplateType = emailTemplateType; // Use passed parameter if provided
        
        if (templateType === 'retainer_agreement') {
            // Check if parental signature is required based on age
            const dobValue = $("#gamer_dob").val()?.trim();
            if (dobValue) {
                const dob = parseDobString(dobValue);
                if (dob && !isNaN(dob.getTime())) {
                    // const age = calcAge(dob);
                    // Under 18 requires parent signature
                    if (age < 18) {
                        dbTemplateName = 'retainer_minor';
                        if (!finalEmailTemplateType) finalEmailTemplateType = 'eligible_with_parent';
                    } else {
                        dbTemplateName = 'retainer_adult';
                        if (!finalEmailTemplateType) finalEmailTemplateType = 'eligible_no_parent';
                    }
                } else {
                    dbTemplateName = 'retainer_minor'; // Default to minor if DOB is invalid
                    if (!finalEmailTemplateType) finalEmailTemplateType = 'eligible_with_parent';
                }
            } else {
                dbTemplateName = 'retainer_minor'; // Default to minor if no DOB
                if (!finalEmailTemplateType) finalEmailTemplateType = 'eligible_with_parent';
            }
        } else {
            dbTemplateName = templateType;
            if (!finalEmailTemplateType) finalEmailTemplateType = 'eligible_no_parent'; // Default
        }
        
        // Prepare API request
        const requestData = {
            user_detail_id: userDetailId,
            template_type: dbTemplateName,
            email_template_type: finalEmailTemplateType
        };

        // Make API call to create document submission
        $.ajax({
            url: '/api/create-document-submission/',
            type: 'POST',
            data: JSON.stringify(requestData),
            contentType: 'application/json',
            headers: {
                'X-CSRFToken': csrftoken
            },
            success: function(response) {
                
                // Close current modal
                closeCustomModal();
                
                if (response.submission_url) {
                    // Show success message and redirect
                    // showModal("Document prepared successfully! You will be redirected to sign the retainer agreement.", "success");
                    
                    setTimeout(() => {
                        // Redirect to NextKeySign signing URL
                        window.location.href = response.submission_url;
                    }, 2000);
                } else {
                    showModal("Error: Could not generate signing URL. Please try again.", "error");
                }
            },
            error: function(xhr, status, error) {
                console.error('Error creating document submission:', error);
                console.error('Response:', xhr.responseText);
                
                let errorMessage = "An error occurred while preparing your document.";
                
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMessage = xhr.responseJSON.error;
                }
                
                showModal(errorMessage, "error");
            }
        });
    }
    
    /**
     * Get current user detail ID
     * This function should return the user_detail_id from the session or form
     * You may need to modify this based on how you store user information
     */
    function getCurrentUserDetailId() {
        // During prequalification flow, get from the most recent submission response
        // This function is called during document creation after user details are submitted
        
        // Option 1: From global variable set during form submission
        if (window.currentUserId) {
            return parseInt(window.currentUserId);
        }
        
        // Option 2: From a hidden form field (if you add one)
        const hiddenField = document.getElementById('user_detail_id');
        if (hiddenField && hiddenField.value) {
            return parseInt(hiddenField.value);
        }
        
        // Option 3: From session storage (fallback for compatibility)
        const sessionId = sessionStorage.getItem('user_detail_id');
        if (sessionId) {
            return parseInt(sessionId);
        }
        
        // If no user detail ID found, user needs to complete contact details first
        console.warn('No user detail ID found. User may need to complete contact details first.');
        return null;
    }


    // Congartulations Popup Script Start

    function showCongrats() {
            const modal = document.getElementById('congratsModal');
            modal.style.display = 'flex';
            
            // Create fireworks
            setTimeout(() => {
                modal.querySelectorAll('.firework').forEach(firework => {
                    firework.style.animation = 'none';
                    void firework.offsetWidth; // Trigger reflow
                    firework.style.animation = 'firework 1s ease-out';
                });
            }, 50);
        }

        function showLoading() {
            document.querySelector('.continue-btn').style.display = 'none';
            const loadingContainer = document.getElementById('loadingContainer');
            const loadingBar = document.getElementById('loadingBar');
            const preparingText = document.getElementById('preparingText');
            
            loadingContainer.style.display = 'block';
            preparingText.style.display = 'block';
            
            setTimeout(() => {
                loadingBar.style.width = '100%';
            }, 100);

            setTimeout(() => {
                // Simulate completion
                // alert('Process complete!');
                location.reload(); // Reset for demo
            }, 2500);
        }
   

        document.addEventListener("DOMContentLoaded", () => {
        const dropdown = document.querySelector(".dropdown");
        const buttonLabel = dropdown.querySelector(".dropdown-label");
        const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');

        function updateLabel() {
            const selected = [...checkboxes]
            .filter(c => c.checked)
            .map(c => c.value);

            buttonLabel.textContent = selected.length === 0
            ? "--Select--"
            : selected.join(", ");
        }

        // prevent dropdown from closing on checkbox click
        dropdown.querySelectorAll(".dropdown-item input").forEach(cb => {
            cb.addEventListener("click", e => e.stopPropagation());
            cb.addEventListener("change", updateLabel);
        });
        });


    </script>

    <!-- Your form and input elements here -->

<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
        const dobInput = document.querySelector('#gamer_dob');

        dobInput.addEventListener('blur', function () {
            let raw = this.value.trim().replace(/\D/g, ''); // Remove non-digits

            if (raw.length === 8) {
                let mm = raw.slice(0, 2);
                let dd = raw.slice(2, 4);
                let yyyy = raw.slice(4, 8);

                // Optional: basic range validation
                let isValidDate = !isNaN(new Date(`${yyyy}-${mm}-${dd}`).getTime());
                if (isValidDate) {
                    this.value = `${mm}-${dd}-${yyyy}`;
                } else {
                    alert("Invalid date entered. Please use MMDDYYYY format.");
                    this.value = "";
                }
            }
        });
    });
</script> -->
</body>


    
</html>


<!-- <button id="openModal" class="btn-primary">Yes</button> -->




   