{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Roblox Intake Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- CSRF Token -->
    <meta name="csrf-token" content="{{ csrf_token }}"">

</head>
<style>
    body {
        background-color: rgb(249 250 251 / var(--tw-bg-opacity,1))#fff;

    }

    .form-bg {
        /* border: 1px solid #ccc; */
        border-top: 5px solid #003947;
        background: #fff;
        border-radius: 10px;
        box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1),0 4px 6px -4px rgb(0 0 0 / 0.1);
    }
    .bg-light {
        background:#e9ecefd4 !important;
    }

    .input-group {
        flex-wrap: nowrap !important;
    }
    .input-group>:not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback) {
    margin-left: calc(var(--bs-border-width) * -2);
    }

    label {
        font-weight: 600;
    }

    .btn-plus {
        background: #04c15f;
        font-size: 14px;
        font-weight: 600;
        margin-top: 30px !important;
        padding: 8px 24px;
    }

    .btn-plus:hover {

        background: #ccc;
        font-size: 14px;
        font-weight: 600;
        margin-top: 30px !important;
        padding: 8px 24px;
    }
    .remove-btn{
         background: #ccc;
    }

    .btn-submit {
        background: #495057;
        color: #fff;
        width: 10rem;
    }

    .btn-submit:hover {
        background: #64686b;
        color: #fff;
        width: 10rem;
    }

    .form-check-label {
        font-weight: 400;
    }

    .btn-ico {
        margin: 0px !important;
        padding: 1px 15px !important;
    }

     .info-icon {
            cursor: pointer;
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            color: white;
            border-radius: 50%;
            font-weight: bold;
        }

        /* Modal styling */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 16%;
            left: 25%;
            width: 250px;
            height: 250px;
            /* background-color: rgba(0,0,0,0.8); */
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80%;
            position: relative;
        }

        .modal-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .close-btn {
            position: absolute;
            top: -25px;
            right: -25px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }

        /* Show modal on hover */
        .info-icon:hover + .modal-overlay,
        .modal-overlay:hover {
            display: flex;
        }
        .Heading-color{
           
            color: #003947;
    font-weight: 700;
        }
        .max-w-4xl {
    max-width: 56rem;
}
.mx-auto {
    margin-left: auto;
    margin-right: auto;
}
label{
    font-size: 14px;
}
input::placeholder,textarea::placeholder {
    font-size: 13px;
    color: #ccc;
}

#inputContainer .robloxValidationStatus {
position: absolute;

}

.des-mg-tp{
margin: 33px 3px;
font-size: 12px;
color: red;
}

</style>

<body class="bg-light">


    <!-- <div class=" mt-4 mb-5 px-3"> -->

        <!-- <div class="row"> -->
<!-- 
            <div class="col-2"></div> -->
                <form id="intakeForm" class="form-bg max-w-4xl mx-auto py-8 px-4 my-3" novalidate>
                  <div class="container">
                    <div class="row" style="border-bottom: 2px solid #495057;">
                        <div class="col-12 text-center">
                        <img src="{% static 'img/Bullock.png' %}" alt="Bullock Image" class="py-2"><h2 class="mb-4 mt-3 px-5 Heading-color">Roblox Intake Form</h2>
                    </div>
                        <!-- <div class="col-2 mt-2">
                            <img src="{% static 'img/Bullock.png' %}" alt="Bullock Image">
                        </div>
                        <div class="col-10 text-left">
                            <h2 class="mb-4 mt-3 px-5">Roblox Intake Form</h2>
                        </div> -->
                    </div>
                    <div class="row mb-3 mt-4">
                        <div class="col-3">
                            <label>Date</label>
                            <input type="date" name="date" class="form-control" required>
                        </div>
                    </div>

                    <label> Gamers Name </label>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-check-label">First Name</label>
                            <input type="text" name="gamer_first_name" class="form-control" placeholder="Enter Gamers First Name" required>
                        </div>
                        <div class="col-6">
                            <label class="form-check-label">Last Name</label>
                            <input type="text" name="gamer_last_name" class="form-control" placeholder="Enter Gamers Last Name" required>
                        </div>
                    </div>

                    <label> Parent or Legal Guardian's Name </label>
                    <div class="row ">
                        <div class="col-6">
                            <label class="form-check-label">First Name</label>
                            <input type="text" name="guardian_first_name" class="form-control"  placeholder="Enter Parent First Name" required>
                        </div>
                        <div class="col-6">
                            <label class="form-check-label">Last Name</label>
                            <input type="text" name="guardian_last_name" class="form-control" placeholder="Enter Parent Last Name" required>
                        </div>
                        <div class="mb-2 row mt-3">
                            <div class="col-12">
                                <label>Do you have legal custody of the gamer (if gamer is a minor)</label><br>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type"
                                            value="married_parent" id="custody1">
                                        <label class="form-check-label" for="custody1">Biological parent, married</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type"
                                            value="divorced_parent" id="custody2">
                                        <label class="form-check-label" for="custody2">Biological parent, divorced with
                                            custody order</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type"
                                            value="adoptive_parent" id="custody3">
                                        <label class="form-check-label" for="custody3">Adoptive parent(s)</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type"
                                            value="legal_guardian" id="custody4">
                                        <label class="form-check-label" for="custody4">Legal Guardian with custody
                                            order</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type"
                                            value="no_custody" id="custody5">
                                        <label class="form-check-label" for="custody5">Do not have legal custody</label>
                                    </div>
                                </div>

                            <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="custody_type" value="other" id="custody6">
                                        <label class="form-check-label" for="custody6">Other</label>
                                    </div>
                                    </div>
                            </div>

                                <!-- Hidden Textbox -->
                                <div id="otherCustodyTextDiv" class="mt-2" style="display: none;">
                                    <label>Please specify:</label>
                                    <input type="text" name="custody_other_detail" class="form-control">
                                </div>

                        </div>


                    </div>

                    <!-- <div class="md-3 row">
                        <div class="col-12">
                            <label >Type a Question</label>
                            <textarea name="question" class="form-control" rows="2" required></textarea>
                        </div>
                    </div> -->


                    <div class="row mt-2">
                        <div class="col-6">
                            <label>Roblox Gamertag 
                                <span class="px-1">(Gamertag start with @ symbol)
                                    <span class="info-icon"> 
                                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                                            width="16" height="16" viewBox="0 0 24 24">
                                            <path
                                                d="M 12 0 C 5.371094 0 0 5.371094 0 12 C 0 18.628906 5.371094 24 12 24 C 18.628906 24 24 18.628906 24 12 C 24 5.371094 18.628906 0 12 0 Z M 12 2 C 17.523438 2 22 6.476563 22 12 C 22 17.523438 17.523438 22 12 22 C 6.476563 22 2 17.523438 2 12 C 2 6.476563 6.476563 2 12 2 Z M 12 5.8125 C 11.816406 5.8125 11.664063 5.808594 11.5 5.84375 C 11.335938 5.878906 11.183594 5.96875 11.0625 6.0625 C 10.941406 6.15625 10.851563 6.285156 10.78125 6.4375 C 10.710938 6.589844 10.6875 6.769531 10.6875 7 C 10.6875 7.226563 10.710938 7.40625 10.78125 7.5625 C 10.851563 7.71875 10.941406 7.84375 11.0625 7.9375 C 11.183594 8.03125 11.335938 8.085938 11.5 8.125 C 11.664063 8.164063 11.816406 8.1875 12 8.1875 C 12.179688 8.1875 12.371094 8.164063 12.53125 8.125 C 12.691406 8.085938 12.816406 8.03125 12.9375 7.9375 C 13.058594 7.84375 13.148438 7.71875 13.21875 7.5625 C 13.289063 7.410156 13.34375 7.226563 13.34375 7 C 13.34375 6.769531 13.289063 6.589844 13.21875 6.4375 C 13.148438 6.285156 13.058594 6.15625 12.9375 6.0625 C 12.816406 5.96875 12.691406 5.878906 12.53125 5.84375 C 12.371094 5.808594 12.179688 5.8125 12 5.8125 Z M 10.78125 9.15625 L 10.78125 18.125 L 13.21875 18.125 L 13.21875 9.15625 Z">
                                            </path>
                                        </svg>
                                    
                                    </span>
                                    <div class="modal-overlay">
                                        <div class="modal-content">
                                            <!-- <span class="close-btn">&times;</span> -->
                                            <img src="{% static 'img/roblox_game_img.jpg' %}" alt="roblox_gamer image">
                                            
                                        </div>
                                    </div>

                                </span>
                            </label>
                            <input type="text" name="roblox_gamertag" class="form-control roblox-gamertag" placeholder="Enter Roblox Gamertag">
                            <div class="robloxValidationStatus mt-1"></div>



                        </div>


                        <div class=" col-3">
                            <button type="button" class="btn btn-plus mt-4" onclick="addInputField()" title="Add a Tag">Add a Tag</button>
                        </div>
                        <div class="row">

                            <div id="inputContainer"  class="col-8"></div>


                        </div>

                    </div>

                    <div class="row mt-3">
                        <div class="col-6">
                            <label>Discord Profile Name</label>
                            <input type="text" name="discord_profile" class="form-control" placeholder="Enter Discord Profile Name">
                        </div>
                          </div>
                          <div class="row mt-2">
                        <div class="col-6">

                            <label>Xbox Gamertag (if applicable)
                                <button type="button" class="btn btn-ico" data-toggle="tooltip" data-placement="bottom"
                                    title="It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout.">
                                    <!-- <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16" height="16"
                                        viewBox="0 0 24 24">
                                        <path
                                            d="M 12 0 C 5.371094 0 0 5.371094 0 12 C 0 18.628906 5.371094 24 12 24 C 18.628906 24 24 18.628906 24 12 C 24 5.371094 18.628906 0 12 0 Z M 12 2 C 17.523438 2 22 6.476563 22 12 C 22 17.523438 17.523438 22 12 22 C 6.476563 22 2 17.523438 2 12 C 2 6.476563 6.476563 2 12 2 Z M 12 5.8125 C 11.816406 5.8125 11.664063 5.808594 11.5 5.84375 C 11.335938 5.878906 11.183594 5.96875 11.0625 6.0625 C 10.941406 6.15625 10.851563 6.285156 10.78125 6.4375 C 10.710938 6.589844 10.6875 6.769531 10.6875 7 C 10.6875 7.226563 10.710938 7.40625 10.78125 7.5625 C 10.851563 7.71875 10.941406 7.84375 11.0625 7.9375 C 11.183594 8.03125 11.335938 8.085938 11.5 8.125 C 11.664063 8.164063 11.816406 8.1875 12 8.1875 C 12.179688 8.1875 12.371094 8.164063 12.53125 8.125 C 12.691406 8.085938 12.816406 8.03125 12.9375 7.9375 C 13.058594 7.84375 13.148438 7.71875 13.21875 7.5625 C 13.289063 7.410156 13.34375 7.226563 13.34375 7 C 13.34375 6.769531 13.289063 6.589844 13.21875 6.4375 C 13.148438 6.285156 13.058594 6.15625 12.9375 6.0625 C 12.816406 5.96875 12.691406 5.878906 12.53125 5.84375 C 12.371094 5.808594 12.179688 5.8125 12 5.8125 Z M 10.78125 9.15625 L 10.78125 18.125 L 13.21875 18.125 L 13.21875 9.15625 Z">
                                        </path>
                                    </svg> -->
                                </button>
                            </label>
                            <input type="text" name="xbox_gamertag" class="form-control" placeholder="Enter Xbox Gamertag">

                        </div>
                        </div>

                  

                    <div class="row mt-2">

                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <label>PlayStation Gamertag (if applicable)</label>
                            <input type="text" name="ps_gamertag" class="form-control" placeholder="Enter PlayStation Gamertag">
                        </div>
                    </div>



                    <div class="mb-3 row mt-3">
                        <div class="col-12">
                            <label>Brief Description of Sexual Predator's Conduct (lying about age, avatar customization,
                                role playing in
                                Roblox, etc) including methods of communication.How did the predator groom the
                                minor?</label>
                            <textarea name="description_predators" class="form-control" rows="2" required placeholder="Enter Brief Description of Sexual Predator's"></textarea>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Brief description of any medical/psychological treatment</label>
                            <textarea name="description_medical_psychological" class="form-control" rows="2"
                                required placeholder="Enter Brief description of any medical treatment"></textarea>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Brief description of any economic loss</label>
                            <textarea name="description_economic_loss" class="form-control" rows="2" required placeholder="Brief description of any economic loss"></textarea>
                        </div>
                    </div>

                    <div class="md-3 row">
                        <div class="col-6">
                            <label>Date of first known contact with sexual predator</label>
                            <input type="date" name="first_contact" class="form-control" placeholder="Enter Date of first known contact with sexual predator">
                        </div>
                        <div class="col-6">
                            <label>Date of last known contact with sexual predator</label>
                            <input type="date" name="last_contact" class="form-control" placeholder="Enter Date of last known contact with sexual predator">
                        </div>
                    </div>



                    <div class="mb-3 row mt-3">
                        <div class="col-12">
                            <label>Did you complain about the predator to Roblox?</label>

                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_roblox" value="Yes"
                                    id="robloxYes">
                                <label class="form-check-label" for="robloxYes">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_roblox" value="No"
                                    id="robloxNo_0">
                                <label class="form-check-label" for="robloxNo_0">No</label>
                            </div>
                        </div>


                    </div>


                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Do you have emails or call logs to document the Complaint to Roblox?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_roblox" value="Yes"
                                    id="robloxYes_1">
                                <label class="form-check-label" for="robloxYes_1">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_roblox" value="No"
                                    id="robloxNo_2">
                                <label class="form-check-label" for="robloxNo_2">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Did you complain to Apple about the predator?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_apple" value="Yes"
                                    id="robloxNo_3">
                                <label class="form-check-label" for="robloxNo_3">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_apple" value="No"
                                    id="robloxNo_4">
                                <label class="form-check-label" for="robloxNo_4">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Do you have emails or call logs to document the Complaint to Apple?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_apple" value="Yes"
                                    id="robloxNo_5">
                                <label class="form-check-label" for="robloxNo_5">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_apple" value="No"
                                    id="robloxNo_6">
                                <label class="form-check-label" for="robloxNo_6">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Did you complain to any credit card company about the predator?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_cc" value="Yes"
                                    id="robloxNo_7">
                                <label class="form-check-label" for="robloxNo_7">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="complained_to_cc" value="No"
                                    id="robloxNo_8">
                                <label class="form-check-label" for="robloxNo_8">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Do you have emails or call logs to document the Complaint to your credit card
                                company?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_cc" value="Yes"
                                    id="robloxNo_9">
                                <label class="form-check-label" for="robloxNo_9">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_cc" value="No"
                                    id="robloxNo_10">
                                <label class="form-check-label" for="robloxNo_10">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="md-3 row">
                        <div class="col-12">
                            <label>If you complained to your credit card company, please identify the names of the credit
                                card
                                companies involved.
                            </label>
                            <textarea name="cc_names" class="form-control" rows="2" required placeholder="Enter complained to your credit card company"></textarea>
                        </div>
                    </div>

                    <div class="md-3 row mt-3">
                        <div class="col-12">
                            <label>Did you contact the Police about the predator?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contacted_police" value="Yes"
                                    id="robloxNo_11">
                                <label class="form-check-label" for="robloxNo_11">Yes</label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contacted_police" value="No"
                                    id="robloxNo_12">
                                <label class="form-check-label" for="robloxNo_12">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="md-3 row mt-2">
                        <div class="col-12">
                            <label>Do you have emails or call logs to document the Complaint to the Police?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_police" value="Yes"
                                    id="robloxNo_13">
                                <label class="form-check-label" for="robloxNo_13">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="emails_to_police" value="No"
                                    id="robloxNo_14">
                                <label class="form-check-label" for="robloxNo_14">No</label>
                            </div>
                        </div>
                    </div>


                    <div class="md-3 row mt-3">
                        <div class="col-12">
                            <label>Provide the name of the Police Department and Case Number.Also provide the current status
                                of
                                the complaint if known
                            </label>
                            <textarea name="police_details" class="form-control" required placeholder="Enter the name police Department"></textarea>
                        </div>
                    </div>
                    <div class="md-3 row mt-3">
                        <div class="col-12">
                            <label>Have you made any complaints to Internet Service Providers or others about the predator?
                                If so,
                                please provide more details.</label>
                            <textarea name="other_complaints" class="form-control" required placeholder="Enter any complaints"></textarea>
                        </div>
                    </div>



                    <div class="md-3 row mt-3">
                        <div class="col-12">
                            <label>Did the predator ask for photos or videos of the minor?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="asked_for_photos" value="Yes"
                                    id="robloxNo_15">
                                <label class="form-check-label" for="robloxNo_15">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="asked_for_photos" value="No"
                                    id="robloxNo_16">
                                <label class="form-check-label" for="robloxNo_16">No</label>

                            </div>
                        </div>
                    </div>


                    <div class="md-3 row mt-2">
                        <div class="col-12">
                            <label>Did the minor provide any photos or videos to the predator?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="minor_sent_photos" value="Yes"
                                    id="robloxNo_17">
                                <label class="form-check-label" for="robloxNo_17">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="minor_sent_photos" value="No"
                                    id="robloxNo_18">
                                <label class="form-check-label" for="robloxNo_18">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="md-3 row mt-2">
                        <div class="col-12">
                            <label>Did the predator distribute the minor's photos or videos to others?</label>

                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_distributed" value="Yes"
                                    id="robloxNo_19">
                                <label class="form-check-label" for="robloxNo_19">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_distributed" value="No"
                                    id="robloxNo_20">
                                <label class="form-check-label" for="robloxNo_20">No</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_distributed" value="Unknown"
                                    id="robloxUnknown_21">
                                <label class="form-check-label" for="robloxUnknown_21">Unknown</label>
                            </div>
                        </div>
                    </div>



                    <div class="md-3 row mt-2">
                        <div class="col-12">
                            <label>Did the predator threaten the minor with public distribution of photos or videos?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_threatened" value="Yes"
                                    id="robloxNo_22">
                                <label class="form-check-label" for="robloxNo_22">Yes</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_threatened" value="No"
                                    id="robloxNo_23">
                                <label class="form-check-label" for="robloxNo_23">No</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="predator_threatened" value="Unknown"
                                    id="robloxUnknown_24">
                                <label class="form-check-label" for="robloxUnknown_24">Unknown</label>
                            </div>
                        </div>
                    </div>


                    <div class="mb-3 row mt-2">
                        <div class="col-12">
                            <label>Did the predator meet the minor in person? If so, describe and provide approximate
                                dates</label>
                            <textarea name="in_person_meeting" class="form-control" required placeholder="Enter the predator meet the minor in person.."></textarea>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>Provide any other additional information that was not asked or that you think would be helpful.</label>
                            <textarea name="additional_info" class="form-control" required placeholder="Provide any other additional information that was not asked or that you think would be helpful"></textarea>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12">
                            <label>For parents/guardians-Describe app roximate date you discovered the predator's conduct
                                and
                                describe how you discovered the predator's conduct (did the minor child tell you, you found
                                evidence, etc.).
                            </label>
                            <textarea name="discovery_info" class="form-control" required placeholder=" parents/guardians-Describe app roximate date you discovered the predator's conduct"></textarea>
                        </div>
                    </div>

                    <span class="mb-3 row">
                        <div class="col-12 d-flex justify-content-center">
                            <button type="submit" class="btn btn-submit mt-3">Submit</button>
                        </div>
                        <!-- <div class="col-6">
                    <button type="button" id="exportBtn" class="btn btn-success mt-3">Export to PDF</button>
                    </div> -->
                    </span>

                    <div id="responseMessage" class="mt-3"></div>
                  </div>
                </form>
            <!-- <div class="col-2"></div> -->
<!-- 
        </div> -->

    <!-- </div> -->

 
    <script>
    // $(document).ready(function () {

    $(document).ready(function () {
    // Get CSRF token
    const csrfToken = $('meta[name=csrf-token]').attr('content');
    
    // Setup CSRF token for all AJAX requests
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                xhr.setRequestHeader("X-CSRFToken", csrfToken);
            }
        }
    });
    const dateFields = ["date", "first_contact", "last_contact"];
    const textFields = [
        "gamer_first_name", "gamer_last_name",
        "guardian_first_name", "guardian_last_name",
        "roblox_gamertag", "discord_profile",
        "xbox_gamertag", "ps_gamertag",
        "custody_other_detail"
    ];
    const textareaFields = [
        "description_predators", "description_medical_psychological",
        "description_economic_loss", "cc_names", "police_details",
        "other_complaints", "in_person_meeting", "additional_info", "discovery_info"
    ];
    const radioFields = [
        "custody_type", "complained_to_roblox", "emails_to_roblox",
        "complained_to_apple", "emails_to_apple", "complained_to_cc",
        "emails_to_cc", "contacted_police", "emails_to_police",
        "asked_for_photos", "minor_sent_photos", "predator_distributed",
        "predator_threatened"
    ];
    let robloxValidationStatus = {};
    // ✅ Roblox Username Validation (blur event)
    $(document).on("blur", ".roblox-gamertag", function () {
    const $input = $(this);
    const username = $input.val().trim();
    const $statusDiv = $input.siblings(".robloxValidationStatus");

    if (!username) return;

    $statusDiv.html("Validating...");
    robloxValidationStatus[$input.index()] = false;

    $.ajax({
        url: "/api/validate-roblox/",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({ username }),
        success: function (response) {
            const message = response.message || "Gamertag found.";
            $statusDiv.html("");
            robloxValidationStatus[$input.index()] = true;
        },
        error: function (xhr) {
            const message = xhr.responseJSON?.error || "Gamertag not found.";
            $statusDiv.html(`<div class="des-mg-tp">${message}</div>`);
            robloxValidationStatus[$input.index()] = false;
            
        }
    });
});




    // Toggle "Other" custody input
    $('input[name="custody_type"]').on('change', function () {
    if ($('#custody6').is(':checked')) {
        $('#otherCustodyTextDiv').show();
    } else {
        $('#otherCustodyTextDiv').hide();
        $('input[name="custody_other_detail"]').val('');
    }
});


    // ✅ Date input limit to today
    $("input[type='date']").each(function () {
        this.max = new Date().toISOString().split("T")[0];
    });

    
    // ✅ Integrated Final Validation
    function validateIntakeForm() {
        let isValid = true;
        $(".text-danger").remove();

        // Date validation
        dateFields.forEach(field => {
            const input = $(`input[name="${field}"]`);
            const value = input.val();
            if (!value) {
                isValid = false;
                input.after('<div class="text-danger">This field is required</div>');
            } else {
                const selectedDate = new Date(value + "T00:00:00");
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                if (selectedDate > today) {
                    isValid = false;
                    input.after('<div class="text-danger">Future dates are not allowed</div>');
                }
            }

            $(".roblox-gamertag").each(function (index) {
            if (robloxValidationStatus[index] === false) {
                // $(this).after('<div class="text-danger">Invalid Roblox username</div>');
                isValid = false;
            }
        });

    });

        // Text field validation
        textFields.forEach(field => {
            const input = $(`input[name="${field}"]`);
            const value = getFieldValues(field);
            if (input.is(':visible') && !value.trim()) {
                isValid = false;
                input.after('<div class="text-danger">This field is required</div>');
            }
        });

        

        // Textarea validation
        textareaFields.forEach(field => {
            const textarea = $(`textarea[name="${field}"]`);
            const value = textarea.val();
            if (!value.trim()) {
                isValid = false;
                textarea.after('<div class="text-danger">This field is required</div>');
            }
        });

        // Radio validation
        radioFields.forEach(field => {
            const selected = $(`input[name="${field}"]:checked`);
            if (selected.length === 0) {
                const container = $(`input[name="${field}"]`).last().closest('.form-check').parent();
                container.append('<div class="text-danger">Please select an option</div>');
                isValid = false;
            }
        });

        // "Other" field validation
        if ($('#custody6').is(':checked')) {
            const otherText = $(`input[name="custody_other_detail"]`);
            if (!otherText.val().trim()) {
                otherText.after('<div class="text-danger">Please specify</div>');
                isValid = false;
            }
        }

        return isValid;
    }

    function getFieldValues(fieldName) {
    const inputs = $(`input[name="${fieldName}"]`);

    if (inputs.length === 0) {
        return null; // Field not found
    } else if (inputs.length === 1) {
        return inputs.val(); // Single field, return string
    } else {
        return inputs.map(function () {
            return $(this).val();
        }).get().filter(Boolean).join(", "); // Multiple fields, return array
    }
}

    // ✅ Form Submit
    $("#intakeForm").on("submit", function (e) {
        e.preventDefault();
        if (!validateIntakeForm()) return;

        const formData = {};
        
        // Collect radio fields
        radioFields.forEach(field => {
            const selected = [];
            $(`input[name="${field}"]:checked`).each(function () {
                selected.push($(this).val());
            });
            formData[field] = selected;
        });
        

        // Collect others
        $(this).serializeArray().forEach(({ name, value }) => {
            if (!radioFields.includes(name)) {
                // ✅ Remove all non-letter characters from the start
               if (name === "roblox_gamertag") {
                        const allGamertags = [];
                        $("input[name='roblox_gamertag']").each(function () {
                            const cleaned = $(this).val().trim().replace(/[@_]/g, '');
                            if (cleaned) allGamertags.push(cleaned);
                        });
                        formData[name] = allGamertags.join(", ");
                    }else {
                    formData[name] = value;
                }
            }
        });
        


    
        $.ajax({
            url: "/api/submit-validated-intake/",
            type: "POST",
            data: JSON.stringify(formData),
            contentType: "application/json",
            success: function () {
                $("#responseMessage").html('<div class="alert alert-success">Form submitted successfully!</div>');
                document.getElementById("intakeForm").reset();
                $('#otherCustodyTextDiv').hide();
                $(".text-danger").remove();
                $("#robloxValidationStatus").html('');
            },
            error: function (xhr) {
                console.error(xhr.responseJSON);
                $("#responseMessage").html('<div class="alert alert-danger">Error submitting form. Check console.</div>');
            }
        });
    });

    // ✅ Export to PDF
    $("#exportBtn").on("click", function () {
        if (!validateIntakeForm()) return;

        const formData = {};
        radioFields.forEach(field => {
            const selected = [];
            $(`input[name="${field}"]:checked`).each(function () {
                selected.push($(this).val());
            });
            formData[field] = selected;
        });

        $("#intakeForm").serializeArray().forEach(({ name, value }) => {
            if (!radioFields.includes(name)) {
                formData[name] = value;
            }
        });

        generatePDF(formData);
    });

    // ✅ PDF Generator
    function generatePDF(formData) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        doc.setFontSize(12);
        doc.text("Roblox Intake Form", 10, y);
        y += 10;

        for (const key in formData) {
            const label = key.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());
            const value = Array.isArray(formData[key]) ? formData[key].join(", ") : formData[key] || "N/A";
            doc.text(`${label}: ${value}`, 10, y);
            y += 8;
            if (y > 270) {
                doc.addPage();
                y = 10;
            }
        }

        doc.save("intake_form.pdf");
    }
});

        // add form field button


        let inputCount = 0;

        function addInputField() {
            inputCount++;

            // Create new input group
            const inputGroup = document.createElement('div');
            inputGroup.className = 'input-group mt-4';

            // Create input element
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder="Enter Additional Roblox Gamertag"
            input.name = 'roblox_gamertag';
            input.className = 'form-control roblox-gamertag';

            const statusDiv = document.createElement('div');
            statusDiv.className = 'robloxValidationStatus mt-1';
            input.style.borderRadius = ' var(--bs-border-radius)';
            // input.type = 'text';
            // input.style.width = '100%';
            // input.style.display = 'block';
            // input.style.padding = '.375rem .75rem';
            // input.style.lineHeight = '1.5';
            // input.style.border = 'var(--bs-border-width)  solid var(--bs-border-color)';
            // input.style.transition = 'border-color .15s ease-in-out, box-shadow .15s ease-in-out';
            

            //         background-color: var(--bs-body-bg);
            // background-clip: padding-box;
            // border: var(--bs-border-width) solid var(--bs-border-color);
           
            // transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
            //         input.placeholder = `Field ${inputCount}`;

            // Create delete button
            const deleteBtn = document.createElement('button');
            
            deleteBtn.title="Remove Tag";
            deleteBtn.innerHTML = 'Remove Tag';
            deleteBtn.style.padding = '4px 15px';
            deleteBtn.style.backgroundColor = '#ff4444';
            deleteBtn.style.color = 'white';
            deleteBtn.style.border = 'none';
            deleteBtn.style.borderRadius = '6px';
            deleteBtn.style.cursor = 'pointer';
            deleteBtn.style.margin = '0px -12px 0px 24px';

            deleteBtn.onclick = function () {
                inputGroup.remove();
            };

            // Add elements to the group
            inputGroup.appendChild(input);
            inputGroup.appendChild(statusDiv);
            inputGroup.appendChild(deleteBtn);

            // Add to container
            document.getElementById('inputContainer').appendChild(inputGroup);
        }

       const closeBtn = document.querySelector('.close-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', function () {
                document.querySelector('.modal-overlay').style.display = 'none';
            });
        }


</script>






</body>
</html>
