<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roblox Intake Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body class="bg-light">
    <div class="container mt-4 mb-5">
        <h2 class="mb-4">Roblox Intake Form</h2>
        <form id="intakeForm">

            <div class="row mb-3">
                <div class="col-md-4">
                    <label>Date</label>
                    <input type="date" name="date" class="form-control" required>
                </div>
            </div>

            <h6 class="mt-4">Name of Gamer</h6>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>First Name</label>
                    <input type="text" name="gamer_first_name" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label>Last Name</label>
                    <input type="text" name="gamer_last_name" class="form-control" required>
                </div>
            </div>

            <h6>Parent or Legal Guardian's Name</h6>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>First Name</label>
                    <input type="text" name="guardian_first_name" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label>Last Name</label>
                    <input type="text" name="guardian_last_name" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label><strong>Do you have legal custody of the gamer (if gamer is a minor)</strong></label><br>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="married_parent" id="custody1">
                        <label class="form-check-label" for="custody1">Biological parent, married</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="divorced_parent" id="custody2">
                        <label class="form-check-label" for="custody2">Biological parent, divorced with custody order</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="adoptive_parent" id="custody3">
                        <label class="form-check-label" for="custody3">Adoptive parent(s)</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="legal_guardian" id="custody4">
                        <label class="form-check-label" for="custody4">Legal Guardian with custody order</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="no_custody" id="custody5">
                        <label class="form-check-label" for="custody5">Do not have legal custody</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="custody_type" value="other" id="custody6">
                        <label class="form-check-label" for="custody6">Other</label>
                    </div>

                    <!-- Hidden Textbox -->
                    <div id="otherCustodyTextDiv" class="mt-2" style="display: none;">
                        <label>Please specify:</label>
                        <input type="text" name="custody_other_detail" class="form-control">
                    </div>
                </div>

               
            </div>

            <div class="md-3">
                <label>Type a Question</label>
                <textarea name="question" class="form-control" rows="2" required></textarea>
            </div>

       
           
            <div class="col-md-3">
                <label>Roblox Gamertag</label>
                <input type="text" name="roblox_gamertag" class="form-control">
            </div>
            <div class="col-md-3">
                <label>Discord Profile Name</label>
                <input type="text" name="discord_profile" class="form-control">
            </div>
            <div class="col-md-3">
                <label>Xbox Gamertag (if applicable)</label>
                <input type="text" name="xbox_gamertag" class="form-control">
            </div>
            <div class="col-md-3">
                <label>PlayStation Gamertag (if applicable)</label>
                <input type="text" name="ps_gamertag" class="form-control">
            </div>
        

           
            <div class="mb-3">
                <label>Brief Description of Sexual Predator's Conduct (lying about age, avatar customization, role playing in
                Roblox, etc) including methods of communication.How did the predator groom the minor?</label>
                <textarea name="description_predators" class="form-control" rows="2" required></textarea>
            </div>
            <div class="mb-3">
                <label>Brief description of any medical/psychological treatment</label>
                <textarea name="description_medical_psychological" class="form-control" rows="2" required></textarea>
            </div>
            <div class="mb-3">
                <label>Brief description of any economic loss</label>
                <textarea name="description_economic_loss" class="form-control" rows="2" required></textarea>
            </div>

            <div class="md-3">
                <label>Date of first known contact with sexual predator</label>
                <input type="date" name="first_contact" class="form-control">
            </div>

            <div class="md-3">
                <label>Date of last known contact with sexual predator</label>
                <input type="date" name="last_contact" class="form-control">
            </div>
        
            <div class="mb-3">
                <label><strong>Did you complain about the predator to Roblox?</strong></label><br>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_roblox" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_roblox" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>

            </div>


            <div class="mb-3">
                <label>Do you have emails or call logs to document the Complaint to Roblox?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_roblox" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_roblox" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="mb-3">
                <label>Did you complain to Apple about the predator?</label>
               <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_apple" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_apple" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="mb-3">
                <label>Do you have emails or call logs to document the Complaint to Apple?</label>
               <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_apple" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_apple" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="mb-3">
                <label>Did you complain to any credit card company about the predator?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_cc" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="complained_to_cc" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="mb-3">
                <label>Do you have emails or call logs to document the Complaint to your credit card company?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_cc" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_cc" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="md-3">
                <label>If you complained to your credit card company, please identify the names of the credit card
                        companies involved.
                </label>
                <textarea name="cc_names" class="form-control" rows="2" required></textarea>
            </div>

            <div class="md-3">
                <label>Did you contact the Police about the predator?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="contacted_police" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="contacted_police" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="md-3">
                <label>Do you have emails or call logs to document the Complaint to the Police?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_police" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="emails_to_police" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>
          

            <div class="md-3">
                <label>Provide the name of the Police Department and Case Number.Also provide the current status of
                        the complaint if known
                </label>
                <textarea name="police_details" class="form-control" required></textarea>
            </div>
            <div class="md-3">
                <label>Have you made any complaints to Internet Service Providers or others about the predator? If so,
                        please provide more details.</label>
                <textarea name="other_complaints" class="form-control" required></textarea>
            </div>


    
            <div class="md-3">
                <label>Did the predator ask for photos or videos of the minor?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="asked_for_photos" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="asked_for_photos" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>


            <div class="md-3">
                <label>Did the minor provide any photos or videos to the predator?</label>
               <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="minor_sent_photos" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="minor_sent_photos" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
            </div>

            <div class="md-3">
                <label>Did the predator distribute the minor's photos or videos to others?</label>
                
                 <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_distributed" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_distributed" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_distributed" value="Unknown" id="robloxUnknown">
                    <label class="form-check-label" for="robloxUnknown">Unknown</label>
                </div>
            </div>


            <div class="md-3">
                <label>Did the predator threaten the minor with public distribution of photos or videos?</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_threatened" value="Yes" id="robloxYes">
                    <label class="form-check-label" for="robloxYes">Yes</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_threatened" value="No" id="robloxNo">
                    <label class="form-check-label" for="robloxNo">No</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="predator_threatened" value="Unknown" id="robloxUnknown">
                    <label class="form-check-label" for="robloxUnknown">Unknown</label>
                </div>
            </div>
    

            <div class="mb-3">
                <label>Did the predator meet the minor in person? If so, describe and provide approximate dates</label>
                <textarea name="in_person_meeting" class="form-control" required></textarea>
            </div>
            <div class="mb-3">
                <label>Provide any other additional information that was not asked or that you think would be helpful.</label>
                <textarea name="additional_info" class="form-control" required></textarea>
            </div>
            <div class="mb-3">
                <label>For parents/guardians-Describe app   roximate date you discovered the predator's conduct and
                        describe how you discovered the predator's conduct (did the minor child tell you, you found
                        evidence, etc.).
                </label>
                <textarea name="discovery_info" class="form-control" required></textarea>
            </div>

            <span><button type="submit" class="btn btn-primary mt-3">Submit</button> <button type="button" id="exportBtn" class="btn btn-success mt-2">Export to PDF</button></span>

            <div id="responseMessage" class="mt-3"></div>
        </form>
    </div>

<script>
    $(document).ready(function () {
        // Toggle visibility for "Other" custody text input
        $('#custody6').on('change', function () {
            if ($(this).is(':checked')) {
                $('#otherCustodyTextDiv').show();
            } else {
                $('#otherCustodyTextDiv').hide();
                $('input[name="custody_other_detail"]').val('');
            }
        });

        // Common fields with multiple checkboxes
        const arrayFields = [
            "custody_type",
            "complained_to_roblox",
            "emails_to_roblox",
            "complained_to_apple",
            "emails_to_apple",
            "complained_to_cc",
            "emails_to_cc",
            "contacted_police",
            "emails_to_police",
            "asked_for_photos",
            "minor_sent_photos",
            "predator_distributed",
            "predator_threatened"
        ];

        // Submit form
        $("#intakeForm").on("submit", function (e) {
            e.preventDefault();
            const formData = {};

            // Collect array fields
            arrayFields.forEach(fieldName => {
                const selected = [];
                $(`input[name='${fieldName}']:checked`).each(function () {
                    selected.push($(this).val());
                });
                formData[fieldName] = selected;
            });

            // Collect the rest of the form data
            $(this).serializeArray().forEach(field => {
                if (!arrayFields.includes(field.name)) {
                    if (field.value === "true" || field.value === "false") {
                        formData[field.name] = field.value === "true";
                    } else {
                        formData[field.name] = field.value;
                    }
                }
            });

            console.log("calling api");

            $.ajax({
                url: "http://127.0.0.1:8000/api/intake-form/",
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                success: function (response) {
                    $("#responseMessage").html('<div class="alert alert-success">Form submitted successfully!</div>');
                    console.log("Submitted:", response);
                    document.getElementById("intakeForm").reset();
                    $('#otherCustodyTextDiv').hide();
                },
                error: function (xhr) {
                    console.error(xhr.responseJSON);
                    $("#responseMessage").html('<div class="alert alert-danger">Error submitting form. Check console.</div>');
                }
            });
        });

        // PDF export
        $("#exportBtn").on("click", function () {
            const formData = {};

            // Collect array fields
            arrayFields.forEach(fieldName => {
                const selected = [];
                $(`input[name='${fieldName}']:checked`).each(function () {
                    selected.push($(this).val());
                });
                formData[fieldName] = selected;
            });

            // Collect the rest of the fields
            $("#intakeForm").serializeArray().forEach(field => {
                if (!arrayFields.includes(field.name)) {
                    if (field.value === "true" || field.value === "false") {
                        formData[field.name] = field.value === "true";
                    } else {
                        formData[field.name] = field.value;
                    }
                }
            });

            generatePDF(formData);
        });

        // PDF generation
        async function generatePDF(formData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let y = 10;
            doc.setFontSize(12);
            doc.text("Roblox Intake Form", 10, y);
            y += 10;

            for (const key in formData) {
                if (formData.hasOwnProperty(key)) {
                    const label = key.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());
                    const value = Array.isArray(formData[key])
                        ? formData[key].join(", ")
                        : formData[key] ? formData[key].toString() : "N/A";
                    doc.text(`${label}: ${value}`, 10, y);
                    y += 8;
                    if (y > 270) {
                        doc.addPage();
                        y = 10;
                    }
                }
            }

            doc.save("intake_form.pdf");
        }
    });
</script>


</body>
</html>
